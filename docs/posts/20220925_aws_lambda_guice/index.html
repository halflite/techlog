<!DOCTYPE html>
<html>
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
      
  AWS Lambda FunctionでJavaを採用したい &ndash; ひとり開発日記。

    </title>
    
    
    <meta name="description" property="og:description" content="承前 AWS Lambda Function を Java で作るというお仕事をしています 基本的に Spring-Boot がメインの現場です Spring-Framawaork はやめておけ、と公式でも言われてますね。1 Java で何かしらする時は、背骨(フレームワーク)欲しいですよね DI(DependencyInjection) 無いと、もう無理ですよね Guice/Dagger を使えと言われていますが、どっち使ったらいいの？ 色々なケースがありますが 自分でやったこと 自分でやったこと google/guice Apache Geronimo Config google/guava で、どうやってビジネスロジック注入する？を考えて、やっぱりgoogle/guiceかなぁって。
設定注入は、Apache Geronimo Configかな 2
Daggerはコンパイル時DI、Guice実行時DI。コンパイル時にDI設定やればそっちの方が速いと思いがちですが、実際やってみると、Javaは起動するとかなり速いので、あまり差が無いのですね。 まぁ、そもそも AWS Lambda Function って、プロダクション的に小さいですし 3 そうすると、コードや設定少ないGuiceの方がいいですよね。
ケース よくあるケースですが、 API Gateway で、何かを送ってもらって、何かをやるみたいなことをやってみましょうか。
public class App implements RequestHandler&amp;lt;APIGatewayProxyRequestEvent, APIGatewayProxyResponseEvent&amp;gt; { private final AnyService anyService; @Override public APIGatewayProxyResponseEvent handleRequest(APIGatewayProxyRequestEvent input, Context context) { this.anyService.execute(input); APIGatewayProxyResponseEvent res = ... // do something return res; } public App() { Injector injector = Guice.|">
    

    <meta name="apple-mobile-web-app-title" content="ひとり開発日記。">
    
    
    
    


    <link rel="stylesheet" href="/techlog/assets/syntax.css">
    <link rel="stylesheet" href="/techlog/assets/primer-build.css">
    <link rel="stylesheet" href="/techlog/assets/style.css">
    <link rel="stylesheet" href="/techlog/assets/custom_style.css">
  </head>


  <body class="bg-gray">
    <div id="holy" class="container-lg bg-white h-100">

      <div id="header" class="px-1 bg-white">
        <nav class="UnderlineNav UnderlineNav--right px-2">
  <a class="UnderlineNav-actions muted-link h2" href="https://halflite.github.io/techlog/">
    ひとり開発日記。
  </a>

  
  
</nav>

      </div>

      <div role="main" id="main" class="holy-main markdown-body px-4 bg-white">
        

<div class="Subhead">
  <div class="Subhead-heading">
    <div class="h1 mt-3 mb-1">AWS Lambda FunctionでJavaを採用したい</div>
  </div>
  <div class="Subhead-description">
    




<a href='/tags/java' class="muted-link">
  <span class="Label Label--gray">java</span>
</a>

<a href='/tags/aws' class="muted-link">
  <span class="Label Label--gray">aws</span>
</a>



    
    <div class="float-md-right">
      <span title="Lastmod: 2022-09-25. Published at: 2022-09-25.">
        
          Published: 2022-09-25
        
      </span>
    </div>
    
  </div>
</div>
<article>
  
  <section class="pb-6 mb-3 border-bottom">
    <h3 id="承前">承前</h3>
<ul>
<li><code>AWS Lambda Function</code> を <code>Java</code> で作るというお仕事をしています
<ul>
<li>基本的に <code>Spring-Boot</code> がメインの現場です</li>
<li><code>Spring-Framawaork</code> はやめておけ、と公式でも言われてますね。<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></li>
</ul>
</li>
<li><code>Java</code> で何かしらする時は、背骨(フレームワーク)欲しいですよね
<ul>
<li><code>DI(DependencyInjection)</code> 無いと、もう無理ですよね</li>
</ul>
</li>
<li><code>Guice</code>/<code>Dagger</code> を使えと言われていますが、どっち使ったらいいの？
<ul>
<li>色々なケースがありますが</li>
</ul>
</li>
</ul>
<h3 id="自分でやったこと">自分でやったこと</h3>
<ul>
<li>自分でやったこと
<ul>
<li><a href="https://github.com/google/guice/wiki">google/guice</a></li>
<li><a href="https://geronimo.apache.org/microprofile/index.html">Apache Geronimo Config</a></li>
<li><a href="https://github.com/google/guava/wiki">google/guava</a></li>
</ul>
</li>
</ul>
<p>で、どうやってビジネスロジック注入する？を考えて、やっぱり<a href="https://github.com/google/guice/wiki">google/guice</a>かなぁって。</p>
<p>設定注入は、<a href="https://geronimo.apache.org/microprofile/index.html">Apache Geronimo Config</a>かな <sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></p>
<p><code>Dagger</code>はコンパイル時DI、<code>Guice</code>実行時DI。コンパイル時にDI設定やればそっちの方が速いと思いがちですが、実際やってみると、<code>Java</code>は起動するとかなり速いので、あまり差が無いのですね。
まぁ、そもそも <code>AWS Lambda Function</code> って、プロダクション的に小さいですし <sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>
そうすると、コードや設定少ない<code>Guice</code>の方がいいですよね。</p>
<h3 id="ケース">ケース</h3>
<p>よくあるケースですが、 <code>API Gateway</code> で、何かを送ってもらって、何かをやるみたいなことをやってみましょうか。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">App</span> <span style="color:#66d9ef">implements</span> RequestHandler<span style="color:#f92672">&lt;</span>APIGatewayProxyRequestEvent<span style="color:#f92672">,</span> APIGatewayProxyResponseEvent<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> AnyService anyService<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> APIGatewayProxyResponseEvent <span style="color:#a6e22e">handleRequest</span><span style="color:#f92672">(</span>APIGatewayProxyRequestEvent input<span style="color:#f92672">,</span> Context context<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">anyService</span><span style="color:#f92672">.</span><span style="color:#a6e22e">execute</span><span style="color:#f92672">(</span>input<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    APIGatewayProxyResponseEvent res <span style="color:#f92672">=</span> <span style="color:#f92672">...</span> <span style="color:#75715e">// do something
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> res<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">App</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Injector injector <span style="color:#f92672">=</span> Guice<span style="color:#f92672">.</span><span style="color:#a6e22e">createInjector</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> AppModule<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">anyService</span> <span style="color:#f92672">=</span> injector<span style="color:#f92672">.</span><span style="color:#a6e22e">getInstance</span><span style="color:#f92672">(</span>AnyService<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Singleton</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AnyService</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">execute</span><span style="color:#f92672">(</span>APIGatewayProxyRequestEvent input<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// do something
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AppModule</span> <span style="color:#66d9ef">extends</span> AbstractModule <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">configure</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    bind<span style="color:#f92672">(</span>AnyService<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// bind microprofile-config.properties
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;</span> props <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>    Sets<span style="color:#f92672">.</span><span style="color:#a6e22e">newLinkedHashSet</span><span style="color:#f92672">(</span>ConfigProvider<span style="color:#f92672">.</span><span style="color:#a6e22e">getConfig</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getConfigSources</span><span style="color:#f92672">())</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">.</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">.</span><span style="color:#a6e22e">map</span><span style="color:#f92672">(</span>ConfigSource<span style="color:#f92672">::</span>getProperties<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">.</span><span style="color:#a6e22e">forEach</span><span style="color:#f92672">(</span>props<span style="color:#f92672">::</span>putAll<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    Names<span style="color:#f92672">.</span><span style="color:#a6e22e">bindProperties</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">binder</span><span style="color:#f92672">(),</span> props<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>まぁー、こんな感じですかね？<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup></p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/best-practices.html" title="AWS Lambda 関数を使用するためのベストプラクティス - AWS Lambda">AWS Lambda 関数を使用するためのベストプラクティス - AWS Lambda</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>JavaEE MicroProfile Config の実装参照なので、まぁ廃れることはないでしょう <a href="https://developer.mamezou-tech.com/msa/mp/cntrn06-mp-config/">第6回 お手軽便利MicroProfile Config | 豆蔵デベロッパーサイト</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>小さく作るべきですよね&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>たまに、こういう(所謂)「黒魔術」成分少ない、手組みのものを作ると、本当に勉強になります&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

  </section>

  <section>
    
      
    
  </section>
</article>

      </div>

      <div id="side" class="pr-1 bg-white">
        <aside class="pr-3">
          
  
    <div id="toc" class="Box Box--blue mb-3">
      <b>AWS Lambda FunctionでJavaを採用したい</b><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#承前">承前</a></li>
        <li><a href="#自分でやったこと">自分でやったこと</a></li>
        <li><a href="#ケース">ケース</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
  

  
    <div>
      
    </div>
  

        </aside>
      </div>

      <div id="footer" class="pt-2 pb-3 bg-white text-center">
        

  <span class="text-small text-gray">
    

    Powered by the
    <a href="https://github.com/qqhann/hugo-primer" class="link-gray-dark">Hugo-Primer</a> theme for
    <a href="https://gohugo.io" class="link-gray-dark">Hugo</a>.
  </span>


      </div>
    </div>

    
    
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>
    
  </body>
</html>
