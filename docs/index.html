<!DOCTYPE html>
<html>
  <head>
	<meta name="generator" content="Hugo 0.107.0">
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
      
  ひとり開発日記。 &ndash; ひとり開発日記。

    </title>
    
    
    <meta name="description" property="og:description" content="">
    

    <meta name="apple-mobile-web-app-title" content="ひとり開発日記。">
    
    
    
    


    <link rel="stylesheet" href="/techlog/assets/syntax.css">
    <link rel="stylesheet" href="/techlog/assets/primer-build.css">
    <link rel="stylesheet" href="/techlog/assets/style.css">
    <link rel="stylesheet" href="/techlog/assets/custom_style.css">
  </head>


  <body class="bg-gray">
    <div id="holy" class="container-lg bg-white h-100">

      <div id="header" class="px-1 bg-white">
        <nav class="UnderlineNav UnderlineNav--right px-2">
  <a class="UnderlineNav-actions muted-link h2" href="https://halflite.github.io/techlog/">
    ひとり開発日記。
  </a>

  
  
</nav>

      </div>

      <div role="main" id="main" class="holy-main markdown-body px-4 bg-white">
        

<div>

  <h1>ひとり開発日記。</h1>
  

  
  <div>
    <div>
      <a href="/techlog/posts/20230602_jms_cosumer_apache_camel/">
        <h3>ActiveMQとQuarkus、Apache Camelで、画像アップロード処理をしたい。 その2 Consumer/Apache Camel編</h3>
      </a>
      <small>https://halflite.github.io/techlog/posts/20230602_jms_cosumer_apache_camel/</small>
      2023-06-02
    </div>
    TL;DR Quarkus - Start coding with code.quarkus.redhat.com で、雛形を作ります。 camel-quarkus-sjms2 / quarkus-artemis-jms を依存関係に含めます。 ルート用のクラスは、DI対象に含めます。 ActiveMQ Altemis用の設定を、application.propertiesに記します。 前回 ActiveMQとQuarkus、ApacheCamelで、画像アップロード処理をしたい。 その1 Producer 編 Apache CamelとQuarkusの第一歩 Camel Extensions for Quarkus と Camel K の入門 - 赤帽エンジニアブログ はい、この通りに、Maven/Gradeleでプロジェクトを作って、実行してみましょう。1 Quarkus - Start coding with code.quarkus.redhat.com Routeの修正 上記のサンプルだと、少々使いづらい。 Routesクラスを以下のように修正します。
継承する親クラスを EndpointRouteBuilder にします。2 タイプセーフで、「流れるようなインターフェース」でルートが書けるようになります。 クラスに @ApplicationScoped アノテーションを付けます。 RoutesクラスがDI対象に含まれます。 ActiveMQからのメッセージ受信 camel-quarkus-sjms2を依存関係に加えます。 諸々必要なコンポーネントが自動で入ります。 ActiveMQ/JMSを通じて、メッセージを受信するためのコンポーネントには、camel-activemq / camel-jmsがあります。 このコンポーネントには、Spring Frameworkのライブラリが依存で入ってしまうのです。 ネット上のサンプルプログラムは、Spring-BootベースのConsumerが多いからでしょうね。 quarkus-artemis-jmsを依存関係に加えます camel-quarkus-sjms2には、ActiveMQとの通信をする、ConnectionFactoryの実装クラスが入ってないのです。 Artemis JMSの記述のようにapplication.propertiesに設定を記述すると、ConnectionFactoryもDI対象になります。 Quarkus Artemis BOMは、Quarkusと違うので、別途依存関係に追加します。 @ApplicationScoped public class Routes extends EndpointRouteBuilder { private final ConnectionFactory connectionFactory; @Override public void configure() throws Exception { from(sjms2(&#34;topic:upload.
  </div>
  
  <div>
    <div>
      <a href="/techlog/posts/20230529_jms_producer/">
        <h3>ActiveMQとQuarkus、Apache Camelで、画像アップロード処理をしたい。 その1 Producer 編</h3>
      </a>
      <small>https://halflite.github.io/techlog/posts/20230529_jms_producer/</small>
      2023-05-29
    </div>
    承前 ブラウザ-&gt;ウェブアプリ-&gt;ActiveMQ-&gt;ApacheCamel-&gt;AWS S3 と言うルートを考えてみましょう。 ウェブアプリでEXIF情報を消去したり、画像縮小を行ってS3にアップロードするには、少々重たい処理ですね。 非同期で、イベント駆動で処理したいですよね。 ウェブアプリはDockerで建てているのだから、ActiveMQ1 も Consumerである Apache Camel2 もDockerでインスタンス作って、メッセージ送信/受信したらいいよね。 …と、思ったら、意外と大変だった、と言う感じです。 JMS(Java Message Service) と Producer と Consumer JMSは歴史的経緯から、とにかく複雑な仕様で、正直に向き合うと、げんなりしてしまうのですけどね…。 まぁ、シンプルにProducer-&gt;ActiveMQ-&gt;Consumerで、送信元Producerが、受信元Consumerに向けて、オブジェクトをメッセージとして送る、オブジェクトのエンコード/デコードを簡単に(？)やってくれる、と、考えたら良いと思います。 今回はウェブアプリがProducerの役割ですね。 ウェブアプリケーションに画像アップロード 結局、ファイル名と拡張子を文字列で取れて、画像のデータをbyte[]か、InputStreamで取れれば良いと思います。 マルチパートでのRESTクライアントの使用 - Quarkus 依存関係に Quarkus RESTEasy Multipart Runtimeを忘れずに。 画像データをActiveMQに送信する JMSの使用 - Quarkus 依存関係に Quarkus Artemis JMS Runtimeを忘れずに。 application.propertiesにquarkus.artemis.***=を記述することを忘れないように。 そうすると、ConnectionFactoryもDI対象になりますよ。 public void uploadImage(String fileName, InputStream file) { try (JMSContext context = this.connectionFactory.createContext(JMSContext.AUTO_ACKNOWLEDGE); ByteArrayOutputStream out = new ByteArrayOutputStream()) { // ファイル読み込み file.transferTo(out); out.flush(); // メッセージ作成 BytesMessage message = context.
  </div>
  
  <div>
    <div>
      <a href="/techlog/posts/20220925_aws_lambda_guice/">
        <h3>AWS Lambda FunctionでJavaを採用したい</h3>
      </a>
      <small>https://halflite.github.io/techlog/posts/20220925_aws_lambda_guice/</small>
      2022-09-25
    </div>
    承前 AWS Lambda Function を Java で作るというお仕事をしています 基本的に Spring-Boot がメインの現場です Spring-Framawaork はやめておけ、と公式でも言われてますね。1 Java で何かしらする時は、背骨(フレームワーク)欲しいですよね DI(DependencyInjection) 無いと、もう無理ですよね Guice/Dagger を使えと言われていますが、どっち使ったらいいの？ 色々なケースがありますが 自分でやったこと 自分でやったこと google/guice Apache Geronimo Config google/guava で、どうやってビジネスロジック注入する？を考えて、やっぱりgoogle/guiceかなぁって。
設定注入は、Apache Geronimo Configかな 2
Daggerはコンパイル時DI、Guice実行時DI。コンパイル時にDI設定やればそっちの方が速いと思いがちですが、実際やってみると、Javaは起動するとかなり速いので、あまり差が無いのですね。 まぁ、そもそも AWS Lambda Function って、プロダクション的に小さいですし 3 そうすると、コードや設定少ないGuiceの方がいいですよね。
ケース よくあるケースですが、 API Gateway で、何かを送ってもらって、何かをやるみたいなことをやってみましょうか。
public class App implements RequestHandler&lt;APIGatewayProxyRequestEvent, APIGatewayProxyResponseEvent&gt; { private final AnyService anyService; @Override public APIGatewayProxyResponseEvent handleRequest(APIGatewayProxyRequestEvent input, Context context) { this.anyService.execute(input); APIGatewayProxyResponseEvent res = ... // do something return res; } public App() { Injector injector = Guice.
  </div>
  
  <div>
    <div>
      <a href="/techlog/posts/20220209_wsl_install/">
        <h3>Windows10にWSL/Ubuntu/Python/Pip環境を最短でインストールしたい</h3>
      </a>
      <small>https://halflite.github.io/techlog/posts/20220209_wsl_install/</small>
      2022-02-09
    </div>
    全くWindows、PowerShell、仮想環境、Pythonも知らない人に、実行環境構築するために教えた時のメモです。
カーネルアップデート実行 PowerShellのコマンドプロンプトで、以下を実行します。1
Invoke-WebRequest -Uri &#34;https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi&#34; -OutFile &#34;wsl_update_x64.msi&#34; ./wsl_update_x64.msi WSL/Ubuntuインストール PowerShellのコマンドプロンプトで、以下を実行します。2
wsl --install -d Ubuntu wsl --set-default Ubuntu Ubuntuに入る PowerShellのコマンドプロンプトで、以下を実行します。
wsl Ubuntuのコマンドプロンプトに入れたと思うので、以下を実行して、Python3が有効か確認します。
python3 --version pip3のインストール Ubuntuのコマンドプロンプトで以下を実行します。
apt -y update &amp;&amp; apt -y install python3-pip 以下を実行して、pip3が有効か確認します。
pip --version 英語のウィンドウが出ますが、&rsquo;next&rsquo;をクリックして、&lsquo;finish&rsquo;まで行けば大丈夫です。&#160;&#x21a9;&#xfe0e;
&ldquo;Retype new password:&ldquo;と言うウィンドウが出ますが、それは、そのまま閉じて下さい。&#160;&#x21a9;&#xfe0e;
  </div>
  
  <div>
    <div>
      <a href="/techlog/posts/20211027_hugo_docker/">
        <h3>Windows10/VSCode/WSL2/Docker/Hugoでblogを書いています</h3>
      </a>
      <small>https://halflite.github.io/techlog/posts/20211027_hugo_docker/</small>
      2021-10-27
    </div>
    bitter*smooth と言う音楽レビューサイトを作っています。
この環境、サーバーサイドはNetlify/Hugo、ローカルではVSCodeでMarkdownを書く、と言う環境で構築しているのですが、あれ？そもそもVSCodeを使うなら、WSL2/DockerDesktop/Remote-Containersでローカル確認もすれば良いんじゃない？と思って、やったらサクッと出来ました！
Windows Terminalインストール
WSL2インストール
Windows Terminal を管理者権限で起動 wsl --install wsl --set-default-version 2 wsl --install -d Ubuntu VSCodeインストール
Windows に Docker Desktop をインストール
まぁ、ここら辺までは、Windows10で開発している人ならフツーに出来るんでないでしょうか？
で、プロジェクトのトップで、 .devcontainer ディレクトリを作り、その配下に、 Dockerfile devcontainer.json の2つのファイルを作ります。
.devcontainer/Dockerfile 1 FROM klakegg/hugo:0.88.0-alpine RUN apk update &amp;&amp; apk --no-cache add git .devcontainer/devcontainer.json 2 { &#34;name&#34;: &#34;bittersmooth&#34;, &#34;build&#34;: { &#34;dockerfile&#34;: &#34;Dockerfile&#34;, }, &#34;extensions&#34;: [ &#34;mhutchie.git-graph&#34; ] } Visual Studio Code を使用して Docker コンテナーを開発環境として使用する - Learn | Microsoft Docs 簡単に Hugo の環境が手に入るのですが、コレひとつだけ落とし穴があって、 hugo server -w でライブローディングが効かないんですね。 まぁ、VSCodeだとMarkdownのプレビューも簡単ですし、最終確認だけ hugo server -w で確認すれば良いのかな？と言う感じでやっています。
  </div>
  
  <div>
    <div>
      <a href="/techlog/posts/20210627_java_dev/">
        <h3>2021年6月 Javaプログラミングで &#34;Hello World&#34; を出したいだけだった</h3>
      </a>
      <small>https://halflite.github.io/techlog/posts/20210627_java_dev/</small>
      2021-06-27
    </div>
    Javaのプログラミングで、 &ldquo;Hello World&rdquo; を出したいと思うでしょう?
まぁ、惰性で以下のことをするでしょう。
JDK(OracleとかOpenJDK)をインストール、パスを通す Mavenをインストール、パスを通す Eclipseをインストール、各種フォーマッターをインストール 今は、2021年6月です。 こう言うのは避けたいですよね。
JDK/JREのバージョンを切り替えるのが難しい JDK/JREは後方互換を重視していたので、ちょっとしたことで対応が難しい 現在の Eclipse って、必要なJDK/JREって、15ですよね Java 11/15で後方互換が切り捨てられたのもあるので、対応はそれなりに必要でしょう 1 Windows10でJava開発環境整える それだけで、一体、いくらのソフトをダウンロードするんです? JDK/Maven/Eclipse のインストールは、大体において鬼門だったりしますね 隣の席の人と、Eclipseのバージョン合ってます？ Mavenでも、変な対応が入ることがありますよ 2 まぁ、結局、以下の如しですわ。
まず世間のIT関連のPCはWindows10ベースなので、それを考える ローカル開発環境に、極力インストールさせない Gitからチェックアウトしたら、すぐ全員の環境と同じになる ここら辺、あなたならどう考えるでしょうね?
JAXB対応 https://github.com/acroquest/javabook-support/issues/49&#160;&#x21a9;&#xfe0e;
Maven 3.8.1 で mvn install 出来ない(maven-default-http-blocker)されたメモ https://qiita.com/bazoo/items/3b5cab094b25cbbd8019&#160;&#x21a9;&#xfe0e;
  </div>
  
  <div>
    <div>
      <a href="/techlog/posts/20210530_quarkus/">
        <h3>Quarkusに入門してみた</h3>
      </a>
      <small>https://halflite.github.io/techlog/posts/20210530_quarkus/</small>
      2021-05-30
    </div>
    Quarkusに入門してみた Quarkus - Creating Your First Application Quarkus を、ちょろっと触っています。
入門編として、「HTMLで入力フォームを作って、画像投稿掲示板を作る」までやってみたいかな、位のモチベーションですかね…。いや、まだ何も出来ていませんが…。
最初に触った感想 とりあえず、簡単に出来るよな 色々揃っているよな、でも外れると何も出来ないよな Vert.x が鬼門かもしれないな とりあえず、簡単に出来るよな とりあえず、mavenでプロジェクト作って、 Hello, World! とか、適当にJSONを出力するのとかは、Javaの基礎知識ある人なら、10分程度で出来るんですよ。
mvn clean compile quarkus:dev で実行させた後、Eclipseとかでデバッグするには、ポート5005のリモート・デバッグを使えばいい、と。1
色々揃っているよな、でも外れると何も出来ないよな 色々道具は揃っているんですが。 ただ、本当に限定的なんですよね…。 2
プレゼンテーション層、(所謂)「HTMLテンプレート」は Qute Templating Engine があるんですが、マジでこれしかないの…？ Thymeleaf はおろか、 FreeMarker にも届かないんでは…。
DBアクセスには、 Hibernate/JPA とか、そのラッパー Panache とかあるんですが、それ以外は…。
まぁ、そもそも Quarkus の役割を考えると、「Backend for Frontendをそこまで作り込むな」と言う主張なのかもしれませんが…。
Vert.x が鬼門かもしれないな Spring Boot って、結局、HttpServletの(適度に)厚いラッパーだったわけで、昔ながらのServletを知っていれば、何とか応用も効いたと思うんですが、 Vert.x は、ホントよく分からんですねぇ。 JAX-RSの下がどうなっているか、きちんと調べないと分からん、と言う。
でもね とは言え、新しい技術に触れると、ホントにワクワクしますわ。
このフレームワークが、どう転ぶのかも分からないんですが、でも、これからのJava標準準拠であることを考えると、やっぱり避けて通れないんでしょうね。 3
Maven testをeclipseでデバッグ | infoScoop開発者ブログ https://bit.ly/2TJzH6W&#160;&#x21a9;&#xfe0e;
Quarkus - Guides - Latest https://quarkus.
  </div>
  
  <div>
    <div>
      <a href="/techlog/posts/20201225_git_2/">
        <h3>2020年12月 CentOS7にgit2.xをyumで入れたかっただけだった。</h3>
      </a>
      <small>https://halflite.github.io/techlog/posts/20201225_git_2/</small>
      2020-12-25
    </div>
    前回から、また変わったので。
sudo yum -y remove git sudo yum -y install https://repo.ius.io/ius-release-el7.rpm sudo yum -y install git224 git --version 元ネタ
iusの最新リンクが変更になったので注意 - Qiita CentOS7にGit2系をyumでインストール - Qiita 
  </div>
  
  <div>
    <div>
      <a href="/techlog/posts/20200918_postgres_local/">
        <h3>2020年9月 ローカル環境に Postgres 12 を立てたいだけだった。</h3>
      </a>
      <small>https://halflite.github.io/techlog/posts/20200918_postgres_local/</small>
      2020-09-18
    </div>
    Heroku で、小さいアプリケーションを作りたいと思っていて。
MySQL も出来ない訳じゃないんですけど1 まぁ、順当に言って Postgres でしょう。 とは言え、今の時代は、Windowsマシンに Postgres を直接インストールするのはアンチパターンですよね…。
という事で、 Vagrant / VirtualBox 上に CentOS7 のインスタンスを作り、それに Ansible で Docker / Docker-Compose をインストール。 その上で、 Docker-Compose を使って、 Postgres を立てる、と言うスクリプトを書いてみました。
https://github.com/halflite/postgresql-win-local こう言う環境を一つ作っておくと、 docker-compose.yml をいじるだけで、 MySQL だったり Redis だったりを簡単に(??)立てられるので、まぁ、ありがたいですねー…。
ClearDB MySQL - Add-ons - Heroku Elements&#160;&#x21a9;&#xfe0e;
  </div>
  
  <div>
    <div>
      <a href="/techlog/posts/20200831_imgbb/">
        <h3>imgbb.comのテスト</h3>
      </a>
      <small>https://halflite.github.io/techlog/posts/20200831_imgbb/</small>
      2020-08-31
    </div>
    ImgBB — フリーなスマイリー / アニメエモコン たまにスクショとかを貼りたい時があって。 図解とか細かい記事だと、 Qiita や Zenn の方が良いんでしょうけど、ここは個人の日記サイトだしね…。
という事で、適当にググって、適当にアップロードして、上記サイトを試してみることにしました。 1
まぁ、削除されても、そんなに重要な画像でもないし…。&#160;&#x21a9;&#xfe0e;
  </div>
  

  
  <nav class="paginate-container">
    <div class="pagination">
      <ul>
        
        <span class="previous_page disabled">Prev</span>
        

        
          <a href="/techlog/">
            1
          </a>
        
          <a href="/techlog/page/2/">
            2
          </a>
        

        
        <a href="/techlog/page/2/" class="next_page">Next</a>
        
      </ul>
    </div>
  </nav>
  


</div>


      </div>

      <div id="side" class="pr-1 bg-white">
        <aside class="pr-3">
          
          <div id="toc" class="mb-3">
          </div>
          
        </aside>
      </div>

      <div id="footer" class="pt-2 pb-3 bg-white text-center">
        

  <span class="text-small text-gray">
    

    Powered by the
    <a href="https://github.com/qqhann/hugo-primer" class="link-gray-dark">Hugo-Primer</a> theme for
    <a href="https://gohugo.io" class="link-gray-dark">Hugo</a>.
  </span>


      </div>
    </div>

    
    
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>
    
  </body>
</html>
